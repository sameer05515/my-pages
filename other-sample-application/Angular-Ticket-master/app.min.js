var app=angular.module("myapp",["ngRoute","firebase","textAngular","ui.bootstrap","googlechart"]);"use strict";app.constant("constants",{firebase:"https://angular-ticket.firebaseio.com/"});
app.config(["$routeProvider",function(b){b.when("/createticket",{controller:"CreateTicketController",templateUrl:"segments/createTicket.html","private":!1}).when("/tickets/:status/:group",{controller:"TicketsController",templateUrl:"segments/tickets.html","private":!0}).when("/liveboard",{templateUrl:"segments/liveBoard.html","private":!0}).when("/ticket/:status/:id",{controller:"TicketController",templateUrl:"segments/ticket.html","private":!0}).when("/test",{controller:"test",templateUrl:"segments/test.html",
"private":!1}).otherwise({redirectTo:"/createticket"})}]);app.run(function(b,a){b.constants=a;b.alert=[]});app.run(function(b,a,c,d){c.$on("$routeChangeStart",function(e,c,g){e=b.path();e=a.routes[e];void 0!=e&&!1!=e["private"]&&!0==e["private"]&&(d.GetUserInfo().email||b.path("/"))})});app.directive("login",function(){return{templateUrl:"segments/login.html"}});app.directive("navagationbar",function(){return{templateUrl:"segments/navagationBar.html"}});
app.factory("FirebaseFactory",function(b,a){var c=new Firebase(b.constants.firebase),d=new FirebaseSimpleLogin(c,function(e,d){e?(a.AlertsAdd({type:"danger",msg:e.code}),b.$broadcast("BroadcastAlertAdded")):d&&a.SetUserInfo(d)});return{auth:function(a){d.login("password",{email:a.email,password:a.pass})},logout:function(){a.SetUserInfo("");d.logout();a.AlertsAdd({type:"success",msg:"Logged Out."});b.$broadcast("BroadcastAlertAdded")}}});
app.factory("TicketsFactory",function(b,a,c){return{create:function(d){return c(new Firebase(b.constants.firebase+"tickets/open")).$asArray().$add(d).then(function(d){d=d.name();a.AlertsAdd({type:"success",msg:'Ticket Created. <a href="#/ticket/open/'+d+'">Please save this link to check and update your ticket status</a>'});b.$broadcast("BroadcastAlertAddedInside")},function(d){console.error("ERROR:",d);a.AlertsAdd({type:"danger",msg:"Something went wrong. Sorry your ticket could not be created."});
b.$broadcast("BroadcastAlertAddedInside");return null})},get:function(a){a=new Firebase(b.constants.firebase+"tickets/"+a);return c(a).$asArray()},find:function(a,e){var f=new Firebase(b.constants.firebase+"tickets/"+e+"/"+a);return c(f).$asObject()},addTicketUpdate:function(a,e){c(new Firebase(b.constants.firebase+"tickets/open/"+a+"/comments")).$asArray().$add(e).then(function(a){a.name()})},changeTicketStatus:function(d,e,f){f=new Firebase(b.constants.firebase+"tickets/"+f+"/"+d);var g=new Firebase(b.constants.firebase+
"tickets/"+e),h=[];f.on("value",function(a){h.push(a.val())});c(g).$set(d,h[0]);c(f).$remove();h=[];a.AlertsAdd({type:"info",msg:"Ticket status changed to "+e});b.$broadcast("BroadcastAlertAddedInside")},changeTicketGroup:function(a,e){var f=new Firebase(b.constants.firebase+"tickets/open/"+a);c(f).$update({group:e})},countOpenTicketsPerGroup:function(){var a=[];a.group={};(new Firebase(b.constants.firebase+"tickets/open")).on("value",function(b){b=b.val();0!=Object.getOwnPropertyNames(a.group).length&&
(a.group={});for(ticket in b)(group=a.group[b[ticket].group])?a.group[b[ticket].group]++:a.group[b[ticket].group]=1});return a}}});
app.controller("TicketController",function(b,a,c,d,e,f,g){a.status=e.status;a.ticket=d.find(e.id,a.status);a.ticketID=e.id;a.addCommentToTicket=function(){c.GetUserInfo().email?(commenter="agent",name=c.GetUserInfo().email):(commenter="user",name="");d.addTicketUpdate(e.id,{time:Firebase.ServerValue.TIMESTAMP,commenterGroup:commenter,commenterName:name,comment:a.ticketUpdateText});a.ticketUpdateText=""};a.changeTicketStatus=function(b,c){d.changeTicketStatus(b,c,a.status);g.path("/tickets/open/all")};
a.changeTicketGroup=function(a){alert(a)};a.changeTicketGroup=function(a,b){d.changeTicketGroup(a,b)}});app.controller("TicketsController",function(b,a,c,d,e,f){a.status=f.status;a.tickets=d.get(a.status);a.showGroup="all"==f.group?"":f.group;a.goToTicket=function(a){e.path("/ticket/"+f.status+"/"+a)};a.ticketSelectionShow=function(a){e.path("/tickets/"+a+"/all")}});
app.controller("CreateTicketController",function(b,a,c,d){a.ticketGroups=d.getConfig("groups");a.createTicket=function(){c.create({date:Firebase.ServerValue.TIMESTAMP,group:a.group,name:a.name,email:a.email,subject:a.subject,number:a.number,details:a.htmlVariable})}});
app.controller("MyRootController",function(b,a,c,d,e,f,g){a.$on("BroadcastAlertAdded",function(){b.$apply(function(){a.alerts=c.AlertsGet()})});a.$on("BroadcastAlertAddedInside",function(){a.alerts=c.AlertsGet()});a.$on("BroadcastUserInfoChanged",function(){a.userInfo=[];b.$apply(function(){a.userInfo.email=c.GetUserInfo().email});a.groupcounts=g.countOpenTicketsPerGroup()});a.login=function(){a.loginForm.$valid&&d.auth({email:a.email,pass:a.password})};a.logout=function(){d.logout()};a.getURL=function(a){return e.path().substr(0,
a.length)==a?"active":""};a.config=f.getConfig("")});
app.factory("HelperFactory",function(b){var a,c;a=[];c=[];return{AlertsAdd:function(b){a.push({type:b.type,msg:b.msg})},AlertsGet:function(){return a},AlertsClose:function(b){a.splice(b,1)},SetUserInfo:function(a){c=a;b.$broadcast("BroadcastUserInfoChanged")},GetUserInfo:function(){return c},ConvertTimeStringToReadable:function(a){dateOne=(new Date(a)).toLocaleString();datesplit=dateOne.split(" ");datestring=datesplit[0];datestringsplit=datestring.split("/");return dateReArrange=datestringsplit[1]+
"/"+datestringsplit[0]+"/"+datestringsplit[2]}}});function AlertsFunction(b,a){b.closeAlert=function(b){a.AlertsClose(b)}}app.factory("ConfigFactory",function(b,a){return{getConfig:function(c){c=new Firebase(b.constants.firebase+"config/"+c);return a(c).$asObject()}}});
app.controller("GoogleChartDataController",function(b,a,c,d){c=new Firebase(a.constants.firebase+"tickets/open");b.chartScope=function(){b.chartObject={};b.chartObject.data={cols:[{id:"t",label:"Status",type:"string"},{id:"s",label:"Tickets",type:"number"}],rows:b.countTickets};b.chartObject.type="PieChart";b.chartObject.options={pieHole:.4,pieSliceText:"value"}};c.on("value",function(c){c=c.val();var d=[];d.group={};var g=[];for(ticket in c)(group=d.group[c[ticket].group])?d.group[c[ticket].group]++:
d.group[c[ticket].group]=1;for(group in d.group)g.push({c:[{v:group},{v:d.group[group]}]});b.countTickets=g;a.$broadcast("BroadcastUpdateCharts");b.chartScope()});b.$on("BroadcastUpdateCharts",function(){a.$apply(function(){b.chartScope()})})});